# Hand-Eye Calibration 진행 가이드

카메라 좌표계와 로봇 좌표계를 동기화하기 위한 캘리브레이션 가이드입니다.

## 현재 진행 상태

- [x] 체커보드 PDF 생성
- [x] Hand-eye calibration 스크립트 작성
- [ ] 체커보드 인쇄 및 준비
- [ ] 캘리브레이션 데이터 수집
- [ ] 좌표계 변환 행렬 계산

---

## Step 1. 체커보드 준비

### 1.1 인쇄
- 파일: `checkerboard_7x10_25mm.pdf`
- **"실제 크기" (100%)** 로 인쇄
- 인쇄 후 자로 측정하여 **사각형 한 칸 = 25mm** 확인

### 1.2 판에 부착
- 딱딱하고 평평한 판 (포맥스, 아크릴, 두꺼운 골판지 등)에 붙이기
- 체커보드가 휘어지지 않도록 단단히 고정

### 1.3 그리퍼에 장착
```
    ┌─────────────────┐
    │  ■ □ ■ □ ■ □   │
    │  □ ■ □ ■ □ ■   │
    │  ■ □ ■ □ ■ □   │  ← 체커보드 (위쪽)
    │  □ ■ □ ■ □ ■   │
    │                 │
    │     [여백]      │  ← 이 부분을 그리퍼로 잡음
    └────────┬────────┘
          [그리퍼]
```
- 체커보드가 **카메라를 향하도록** 배치
- 로봇 움직여도 **흔들리지 않게** 단단히 고정

---

## Step 2. 시스템 준비

### 2.1 로봇 드라이버 실행
```bash
# 터미널 1
cd ~/doosan_ws
source install/setup.bash
ros2 launch dsr_bringup2 dsr_bringup2_rviz.launch.py
```

### 2.2 RealSense 카메라 연결 확인
```bash
# 터미널 2
realsense-viewer
```
- 카메라가 체커보드를 잘 볼 수 있는지 확인
- 확인 후 뷰어 종료

---

## Step 3. 캘리브레이션 실행

### 3.1 캘리브레이션 스크립트 실행
```bash
# 터미널 2
cd ~/doosan_ws/src/e0509_gripper_description/scripts/sim2real
python3 hand_eye_calibration.py
```

### 3.2 조작 방법
| 키 | 동작 |
|----|------|
| `s` | 현재 자세 저장 |
| `c` | 캘리브레이션 수행 |
| `d` | 마지막 데이터 삭제 |
| `r` | 모든 데이터 초기화 |
| `q` | 종료 |

### 3.3 데이터 수집 요령
1. **최소 15개 이상**의 다양한 자세 수집
2. 로봇을 다양한 위치/각도로 이동
3. 체커보드가 카메라 프레임 안에 완전히 보이는지 확인
4. 각 자세에서 `s` 키로 저장

**좋은 자세 예시:**
- 카메라 정면, 좌측, 우측
- 체커보드 기울임 (상하좌우)
- 카메라와의 거리 다양하게 (30cm ~ 80cm)

---

## Step 4. 결과 확인

### 4.1 캘리브레이션 수행
- 데이터 수집 완료 후 `c` 키 입력
- 변환 행렬이 계산되고 저장됨

### 4.2 결과 파일
- `calibration_result.npz`: 최종 변환 행렬
- `calibration_data.npz`: 수집된 데이터 (백업)

### 4.3 결과 테스트
```bash
python3 coordinate_transformer.py
```

---

## 파일 구조

```
sim2real/
├── checkerboard_7x10_25mm.pdf   # 프린트용 체커보드
├── generate_checkerboard.py      # 체커보드 생성 스크립트
├── hand_eye_calibration.py       # 캘리브레이션 스크립트
├── coordinate_transformer.py     # 좌표 변환 유틸리티
├── robot_observation.py          # 로봇 observation 수집
├── calibration_result.npz        # (생성됨) 캘리브레이션 결과
└── calibration_data.npz          # (생성됨) 수집된 데이터
```

---

## 체커보드 정보

| 항목 | 값 |
|------|-----|
| 사각형 개수 | 7 x 10 |
| 내부 코너 (OpenCV) | 6 x 9 |
| 사각형 크기 | 25mm |
| 전체 크기 | 175mm x 250mm |

---

## 문제 해결

### 체커보드가 인식되지 않을 때
- 조명이 충분한지 확인
- 체커보드가 프레임 안에 완전히 들어오는지 확인
- 카메라 초점이 맞는지 확인

### 캘리브레이션 오차가 클 때
- 더 많은 자세 데이터 수집 (20개 이상)
- 더 다양한 각도로 데이터 수집
- 체커보드가 평평한지 확인
